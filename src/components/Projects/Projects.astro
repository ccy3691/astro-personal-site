---
import '../../styles/shared.css';
import ProjectCard from './ProjectCard.astro';
import surveyPlatform from '../../assets/survey_platform.webp';
import portfolioSite from '../../assets/portfolio_site.webp';
import notelyImg from '../../assets/notely.webp';

const projects = [
	{
		image: { src: surveyPlatform.src, alt: 'Autosolve Survey Platform' },
		title: 'Autosolve Survey Platform',
		description: 'Solo project to build full web application for client. Survey platform for creating, sending, and analyzing surveys results to aid in business operations',
		tags: ['React', 'Laravel', 'Postgres', 'Multitenant']
	},
	{
		image: { src: portfolioSite.src, alt: 'Portfolio Website' },
		title: 'Portfolio Website',
		titleLink: 'https://github.com/ccy3691/astro-personal-site',
		description: 'Simple static site to showcase my experience and some of my projects',
		tags: ['Astro', 'Tailwind', 'Cloudflare Pages']
	},
	{
		image: { src: notelyImg.src, alt: 'Notely' },
		title: 'Notely',
		titleLink: 'https://github.com/ccy3691/notely',
		description: 'A note-taking web application that uses AI for fast full-text search and automatic generation of flashcards from notes. Allows users to organize notes with categories and quiz themselves using generated flashcards.',
		tags: ['Laravel', 'VueJS', 'AI', 'Postgres']
	}
];
---

<section id="projects" class="section projects-section">
	<div class="section-container">
		<h2 class="section-title">Projects</h2>
		<div class="projects-grid">
            {projects.map(project => (
                <ProjectCard project={project} />
            ))}
		</div>
	</div>

	<!-- Image Lightbox Modal -->
	<div id="imageLightbox" class="lightbox">
		<span class="lightbox-close">&times;</span>
		<img class="lightbox-content" id="lightboxImage" src="" alt="" />
	</div>
</section>

<script>
	// Intersection Observer for fade-in animations
	const observerOptions = {
		threshold: 0.1,
		rootMargin: '0px 0px -50px 0px'
	};

	const observer = new IntersectionObserver((entries) => {
		entries.forEach(entry => {
			if (entry.isIntersecting) {
				entry.target.style.opacity = '1';
			}
		});
	}, observerOptions);

	document.querySelectorAll('.project-card').forEach(el => {
		observer.observe(el);
	});

	// Lightbox functionality
	const lightbox = document.getElementById('imageLightbox');
	const lightboxImage = document.getElementById('lightboxImage');
	const closeBtn = document.querySelector('.lightbox-close');

	// Open lightbox on image click
	document.querySelectorAll('.clickable-image').forEach(img => {
		img.addEventListener('click', function() {
			lightbox!.style.display = 'flex';
			lightboxImage!.src = this.dataset.image;
			lightboxImage!.alt = this.dataset.alt;
		});
	});

	// Close lightbox
	closeBtn?.addEventListener('click', () => {
		lightbox!.style.display = 'none';
	});

	// Close lightbox when clicking outside the image
	lightbox?.addEventListener('click', (e) => {
		if (e.target === lightbox) {
			lightbox.style.display = 'none';
		}
	});

	// Close lightbox with Escape key
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape') {
			lightbox!.style.display = 'none';
		}
	});
</script>

<style>
    .projects-section {
        background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-white) 100%);
        transition: background 0.3s ease;
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

     @media (max-width: 768px) {
        .projects-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
    }
</style>
